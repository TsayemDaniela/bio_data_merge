{% extends 'base.html' %} {% block title %} Search Results {% endblock %} {%
block content %}

<div
  class="flex-grow flex flex-col bg-gray-200 dark:bg-gray-200 flex-grow dark:text-gray-800"
>
  {% if queryResult %}
  <div class="w-[1200px] h-[600px] bg-gray-100 my-20 mx-auto" id="graph"></div>
  <div class="mx-auto w-96">
      <div class="panel panel-default">
        <div class="panel-heading text-xl font-boldeva">Search Results for {{ query_name}}</div>
        <!-- <table id="results" class="table-fixed">
          <thead>
            <tr>
              <th>Movie</th>
              <th>Released</th>
              <th>Tagline</th>
              <th>Votes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table> -->
      </div>
    </div>
  </div>
    
  {% endif %}
</div>
<style type="text/css">
  .node {
    stroke: #222;
    stroke-width: 1.5px;
  }
  .link {
    stroke: #999;
    stroke-opacity: 0.6;
    stroke-width: 1px;
  }

  div.tooltip-donut {
    position: absolute;
    text-align: center;
    padding: 0.5rem;
    background: #ffffff;
    color: #313639;
    border: 1px solid #313639;
    border-radius: 8px;
    pointer-events: none;
    font-size: 1.3rem;
    inline-size: 200px;
    overflow-wrap: break-word;
  }
</style>
<script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript">
  const width = 1200,
    height = 600;

  const force = d3.layout
    .force()
    .charge(-100)
    .linkDistance(140)
    .size([width, height]);

  const svg = d3
    .select("#graph")
    .append("svg")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("pointer-events", "all");

  d3.json("/interactor/search/results/graph", function (error, graph) {
    if (error) {
      throw error;
      return;
    }

    force.nodes(graph.nodes).links(graph.links).start();

    var color = d3.scale.category20();

    var div = d3
      .select("body")
      .append("div")
      .attr("class", "tooltip-donut")
      .style("opacity", 0);

    const link = svg
      .selectAll(".link")
      .data(graph.links)
      .enter()
      .append("line")
      .attr("class", "link");

    const node = svg
      .selectAll(".node")
      .data(graph.nodes)
      .enter()
      .append("circle")
      .attr("class", function (d) {
        return "node " + d.label;
      })
      .attr("r", 20)
      .attr("fill", function (d, i) {
        return color(i);
      })
      .on("mouseover", function (d, i) {
        d3.select(this).transition().duration("50").attr("opacity", ".85");
        //Makes the new div appear on hover:
        div.transition().duration(50).style("opacity", 1);
        div
          .html(`${d.title}`)
          .style("left", d3.event.pageX + 10 + "px")
          .style("top", d3.event.pageY - 15 + "px");
      })
      .on("mouseout", function (d, i) {
        d3.select(this).transition().duration("50").attr("opacity", "1");
        //Makes the new div disappear:
        div.transition().duration("50").style("opacity", 0);
      })
      .call(force.drag);

    // force feed algo ticks
    force.on("tick", function () {
      link
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y;
        })
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y;
        });

      node
        .attr("cx", function (d) {
          return d.x;
        })
        .attr("cy", function (d) {
          return d.y;
        });
    });
  });

  const data = graph.nodes
  const t = $("table#results tbody").empty();
   //  if (!data || data.length == 0) return;
    data.forEach(function (interactor, index) {
        $("<tr><td class='interactor'>" + interactor.title
            + "</td><td>" + interactor.released
            + "</td><td>" + interactor.tagline
            + "</td><td id='votes" + index + "'>" + (interactor.votes || 0)
            + "</td></tr>").appendTo(t)
    });

</script>
<script type="text/javascript">
 
</script>
{% endblock %}
